# This test requires some tweaks from the current default Cromwell values to run on the Local backend.
#
# Set the following in config. `copy` duplication is required as this test modifies a file and that modification
# would otherwise manifest in a (sym)linked duplicate which would cause the test to fail.
#
# backend.providers.Local.config.filesystems.local.caching.duplication-strategy = ["copy"]
# backend.providers.Local.config.filesystems.local.localization = ["soft-link", "copy"]

name: draft3_call_cache_capoeira_local
testFormat: workflowsuccess
backends: [Local]
workflowType: WDL
workflowTypeVersion: 1.0
tags: ["wdl_1.0", localdockertest]

files {
  workflow: wdl_draft3/call_cache_capoeira/draft3_call_cache_capoeira_local.wdl
}

metadata {
  workflowName: draft3_call_cache_capoeira
  status: Succeeded
  "calls.draft3_call_cache_capoeira.make_files.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.make_files_cached.callCaching.result": "Cache Hit: <<UUID>>:draft3_call_cache_capoeira.make_files:-1"

  "calls.draft3_call_cache_capoeira.read_files.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.modify_file_sfs.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_after_modify.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_copied_files.callCaching.result": "Cache Hit: <<UUID>>:draft3_call_cache_capoeira.read_files:-1"
  "calls.draft3_call_cache_capoeira.read_files_swapped.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_new_command.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_new_output_expressions.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_new_output_names.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_non_file_input_switcheroo.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_inputs_renamed.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_different_docker.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_without_docker.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_different_continueOnReturnCode.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_different_continueOnReturnCode_2.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_files_different_failOnStderr.callCaching.hit": false

  "calls.draft3_call_cache_capoeira.read_files_whitespace.callCaching.hit": true
  "calls.draft3_call_cache_capoeira.read_files_without_continueOnReturnCode.callCaching.hit": true
  "calls.draft3_call_cache_capoeira.read_files_without_failOnStderr.callCaching.hit": true
  "calls.draft3_call_cache_capoeira.read_files_failOnStderr_expression.callCaching.hit": true
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hit": false
  "calls.draft3_call_cache_capoeira.read_array_files_rearranged.callCaching.hit": false
  
  // Check that hashes are published to metadata
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.output count": "C81E728D9D4C2F636F067F89CC14862C"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.runtime attribute.docker": "09F611634147800124391D34D57A3A9F"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.runtime attribute.continueOnReturnCode": "CFCD208495D565EF66E7DFF9F98764DA"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.runtime attribute.failOnStderr": "68934A3E9455FA72420237EB05902327"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.output expression.Boolean done": "B326B5062B2F0E69046810717534CB09"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.output expression.String s": "A865407608C706C3A061C106080F8497"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.input count": "ECCBC87E4B5CE2FE28308FD9F2A7BAF3"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.command template": "ED56C94E5CD5871CDB6D9A702F299073"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.input.Boolean ready": "B326B5062B2F0E69046810717534CB09"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.input.File b.0": "388a16fd2d5d64d96cc14c95125d4b21"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.input.File a.0": "0e4a079e970c7802de92f5151e0dc2b9"
  "calls.draft3_call_cache_capoeira.read_array_files.callCaching.hashes.backend name": "509820290D57F333403F490DDE7316F4"
}
