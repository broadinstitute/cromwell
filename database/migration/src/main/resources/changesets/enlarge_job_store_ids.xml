<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog objectQuotingStrategy="QUOTE_ALL_OBJECTS"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">


    <changeSet author="mcovarr" id="drop_fk_job_store_simpleton_entry_job_store_entry_id_constraint" dbms="mysql,hsqldb,postgresql,mariadb">
      <dropForeignKeyConstraint baseTableName="JOB_STORE_SIMPLETON_ENTRY"
                                constraintName="FK_JOB_STORE_SIMPLETON_ENTRY_JOB_STORE_ENTRY_ID" />
    </changeSet>


    <changeSet author="mcovarr" id="enlarge_job_store_simpleton_entry_id" dbms="mysql,hsqldb,mariadb">
        <addAutoIncrement columnName="JOB_STORE_SIMPLETON_ENTRY_ID"
                          columnDataType="BIGINT"
                          incrementBy="1"
                          tableName="JOB_STORE_SIMPLETON_ENTRY"/>
    </changeSet>

    <changeSet author="mcovarr" id="pg_enlarge_job_store_simpleton_entry_id" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*)
                FROM information_schema.sequences
                WHERE sequence_name = 'JOB_STORE_SIMPLETON_ENTRY_JOB_STORE_SIMPLETON_ENTRY_ID_seq'
                AND data_type = 'bigint';
            </sqlCheck>
        </preConditions>
        <sql>alter sequence "JOB_STORE_SIMPLETON_ENTRY_JOB_STORE_SIMPLETON_ENTRY_ID_seq" as bigint;</sql>
    </changeSet>

    <changeSet author="mcovarr" id="enlarge_job_store_entry_id" dbms="mysql,hsqldb,mariadb">
        <addAutoIncrement columnName="JOB_STORE_ENTRY_ID"
                          columnDataType="BIGINT"
                          incrementBy="1"
                          tableName="JOB_STORE_ENTRY"/>
    </changeSet>

    <changeSet author="mcovarr" id="pg_enlarge_job_store_entry_id" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*)
                FROM information_schema.sequences
                WHERE sequence_name = 'JOB_STORE_ENTRY_JOB_STORE_ENTRY_ID_seq'
                AND data_type = 'bigint';
            </sqlCheck>
        </preConditions>
        <sql>alter sequence "JOB_STORE_ENTRY_JOB_STORE_ENTRY_ID_seq" as bigint;</sql>
    </changeSet>

    <changeSet author="mcovarr" id="enlarge_job_store_simpleton_entry_fk" dbms="mysql,hsqldb,postgresql,mariadb">
        <modifyDataType tableName="JOB_STORE_SIMPLETON_ENTRY"
                        columnName="JOB_STORE_ENTRY_ID"
                        newDataType="BIGINT"/>
    </changeSet>

    <changeSet author="mcovarr" id="recreate_job_store_simpleton_entry_fk_mariadb" dbms="mariadb">
        <addForeignKeyConstraint
                baseColumnNames="JOB_STORE_ENTRY_ID"
                baseTableName="JOB_STORE_SIMPLETON_ENTRY"
                constraintName="FK_JOB_STORE_SIMPLETON_ENTRY_JOB_STORE_ENTRY_ID"
                onDelete="CASCADE"
                referencedColumnNames="JOB_STORE_ENTRY_ID"
                referencedTableName="JOB_STORE_ENTRY"/>
    </changeSet>

    <changeSet author="mcovarr" id="recreate_job_store_simpleton_entry_fk_postgres" dbms="postgresql">
        <addForeignKeyConstraint baseColumnNames="JOB_STORE_ENTRY_ID"
                                 baseTableName="JOB_STORE_SIMPLETON_ENTRY"
                                 constraintName="FK_JOB_STORE_SIMPLETON_ENTRY_JOB_STORE_ENTRY_ID"
                                 onDelete="CASCADE"
                                 referencedColumnNames="JOB_STORE_ENTRY_ID"
                                 referencedTableName="JOB_STORE_ENTRY"/>
    </changeSet>

    <changeSet author="mcovarr" id="recreate_job_store_simpleton_entry_fk_others" dbms="mysql,hsqldb">
        <addForeignKeyConstraint constraintName="FK_JOB_STORE_SIMPLETON_ENTRY_JOB_STORE_ENTRY_ID" onDelete="CASCADE"
                                 baseTableName="JOB_STORE_SIMPLETON_ENTRY"
                                 baseColumnNames="JOB_STORE_ENTRY_ID"
                                 referencedTableName="JOB_STORE_ENTRY"
                                 referencedColumnNames="JOB_STORE_ENTRY_ID"/>
    </changeSet>

</databaseChangeLog>
