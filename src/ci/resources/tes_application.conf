include required(classpath("application.conf"))
include "build_application.inc.conf"

filesystems {

    blob {
        class = "cromwell.filesystems.blob.BlobPathBuilderFactory"
        global {
          class = "cromwell.filesystems.blob.BlobFileSystemManager"
          config {
            workspace-manager: {
              url: "https://workspace.dsde-dev.broadinstitute.org"
              workspace-id: "d4564046-bbba-495c-afec-14f7d3a8283a"
              container-resource-id: "9e7bdba5-047e-430c-810d-c7cb6645c155"
              b2cToken: "eyJhbGciOiJSUzI1NiIsImtpZCI6Inp4UnJ6aEw4OTBrYi1vVkZOWkdWUFlxSzYtSkI3RFRlTGVvMllTbzRtc1UiLCJ0eXAiOiJKV1QifQ.eyJlbWFpbCI6InR3aXNlbWFuQGJyb2FkaW5zdGl0dXRlLm9yZyIsImdpdmVuX25hbWUiOiJUaG9tYXMiLCJmYW1pbHlfbmFtZSI6Ildpc2VtYW4iLCJuYW1lIjoiVGhvbWFzIFdpc2VtYW4iLCJpZHAiOiJnb29nbGUuY29tIiwiaWRwX2FjY2Vzc190b2tlbiI6InlhMjkuYTBBZkJfYnlEMU5hdF9YWldYMDg0Z1lxU1BHWWpjOWVTMlNEcFJhRVJNOFprVjJWc25aUU9QMndrWEJycmVQQWlwWGMzWXJwYUhQanhoVmEwRWk1NTlGTmpkZExwVHBXY0Y4SFNlTHJiTnZqaWNCYUo3cVZMWUR3aThvdXVrMzNLVjJ6V3RrcWY3YWhueVRtZVVxaEo4aG1FUTlwOHk0c3VaOTAyMkNHQWFDZ1lLQVIwU0FSQVNGUUhzdllsc3otXzctSlNrbGx6Zld3V3Y1OWtOdVEwMTc0IiwiZ29vZ2xlX2lkIjoiMTExNDI1MTI3NzgyODk3OTE5MjIxIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FBY0hUdGNhZWxfZTl4dHdJQWdOZW1YY2N4d18xUWtlVjV1cF91NUFRTUMxMU5xNj1zOTYtYyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJzdWIiOiJhMzYxY2YxNS0xNTgxLTQ2ZDQtYmJkNC1mMGQ0NGFlNjkwODciLCJ0aWQiOiJmZDBiYzBlZi0xNzQ3LTRlZTYtYWIzZS1kNGQ2YmI4ODJkNDAiLCJhenAiOiJiYmQwN2Q0My0wMWNiLTRiNjktOGZkMC01NzQ2ZDlhNWM5ZmUiLCJ2ZXIiOiIxLjAiLCJpYXQiOjE2OTE3NjE1NDUsImF1ZCI6ImJiZDA3ZDQzLTAxY2ItNGI2OS04ZmQwLTU3NDZkOWE1YzlmZSIsImV4cCI6MTY5MTc2NTE0NSwiaXNzIjoiaHR0cHM6Ly90ZXJyYWRldmIyYy5iMmNsb2dpbi5jb20vZmQwYmMwZWYtMTc0Ny00ZWU2LWFiM2UtZDRkNmJiODgyZDQwL3YyLjAvIiwibmJmIjoxNjkxNzYxNTQ1fQ.k8XqUUWWfsJqVru8AdD8PqMw5js0Dlp7vtKWG2HxUDCNuQoz9ERs-QbvWU2XHmQZ2kS4zVtTzDoTc4PbNJ_Dy81I9nNDczdMxsyhKZ1GhJHiuS_h6nFaweLQTKCfrzye10VJdZlyR0cfBllbu7ct6-S91AvpTbwxKmU2p33eBw4ToEwdYNrDkbrIxmUHwrVN0nmoxQcIcouD0pOMcpR_Ad6hYWn1s9ug3BguM6jAhhjXWxJj4DIdcJ4mnDDhKkWbcV-NdphNVSl1COAY7hstEuHMK_3-Of6l1SMB9I-WA-M1esDmsXAcL1y8g0DTIdzDkEqrrxOb4k-NbQCgMiMElw"
              }
            container: "sc-d4564046-bbba-495c-afec-14f7d3a8283a"
            endpoint: "https://lz43a8a3d21540dfd25f5ace.blob.core.windows.net"
          }
        }
      }
#   blob {
#     class = "cromwell.filesystems.blob.BlobPathBuilderFactory"
#     global {
#       # One BFSM is shared across all BlobPathBuilders
#       class = "cromwell.filesystems.blob.BlobFileSystemManager"
#       config {
#         container: "cromwell"
#         endpoint: "https://coaexternalstorage.blob.core.windows.net"
#         subscription: "62b22893-6bc1-46d9-8a90-806bb3cce3c9"
#         # WSM config is needed for accessing WSM-managed blob containers
#         # created in Terra workspaces.
#         workspace-manager {
#           url: "https://workspace.dsde-dev.broadinstitute.org"
#           workspace-id: "ebda3e1d-09bf-48b1-be2e-3d09f67dfc5c"
#           container-resource-id: "983bcc2b-3134-48d0-b52b-5df1fe09d161"
#           b2cToken: "Bearer eyJhbGciOiJSUzI1NiIsImt...Jw49ZA"
#         }
#       }
#     }
#   }
}

engine {
  filesystems {
    local {
      enabled: true
    }
    http {
      enabled: true
    }
    blob {
      enabled: true
    }
  }
}


backend {
  default = "TES"
  providers {
    TES {
      actor-factory = "cromwell.backend.impl.tes.TesBackendLifecycleActorFactory"
      config {
        # Use for running on blob storage
        #root = "https://coaexternalstorage.blob.core.windows.net/cromwell/janet-20230505"
        root = "https://lz43a8a3d21540dfd25f5ace.blob.core.windows.net/sc-d4564046-bbba-495c-afec-14f7d3a8283a/workspace-services/cbas/terra-app-566e92a0-e55e-4250-b4c1-d0925dd03916-d4564046-bbba-495c-afec-14f7d3a8283a/"
        #root = "cromwell-executions"
        dockerRoot = "/cromwell-executions"
        endpoint = "https://lzd98e904c9c1cee247af683bc764eb1b22f3912f8e7839afe.servicebus.windows.net/terra-app-566e92a0-e55e-4250-b4c1-d0925dd03916-d4564046-bbba-495c-afec-14f7d3a8283a/tes/v1/tasks"
        concurrent-job-limit = 1000
        workflow-execution-identity = "pet-2676571657071603a9eab"
        bearer-token= "Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6Inp4UnJ6aEw4OTBrYi1vVkZOWkdWUFlxSzYtSkI3RFRlTGVvMllTbzRtc1UiLCJ0eXAiOiJKV1QifQ.eyJlbWFpbCI6InR3aXNlbWFuQGJyb2FkaW5zdGl0dXRlLm9yZyIsImdpdmVuX25hbWUiOiJUaG9tYXMiLCJmYW1pbHlfbmFtZSI6Ildpc2VtYW4iLCJuYW1lIjoiVGhvbWFzIFdpc2VtYW4iLCJpZHAiOiJnb29nbGUuY29tIiwiaWRwX2FjY2Vzc190b2tlbiI6InlhMjkuYTBBZkJfYnlEMU5hdF9YWldYMDg0Z1lxU1BHWWpjOWVTMlNEcFJhRVJNOFprVjJWc25aUU9QMndrWEJycmVQQWlwWGMzWXJwYUhQanhoVmEwRWk1NTlGTmpkZExwVHBXY0Y4SFNlTHJiTnZqaWNCYUo3cVZMWUR3aThvdXVrMzNLVjJ6V3RrcWY3YWhueVRtZVVxaEo4aG1FUTlwOHk0c3VaOTAyMkNHQWFDZ1lLQVIwU0FSQVNGUUhzdllsc3otXzctSlNrbGx6Zld3V3Y1OWtOdVEwMTc0IiwiZ29vZ2xlX2lkIjoiMTExNDI1MTI3NzgyODk3OTE5MjIxIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FBY0hUdGNhZWxfZTl4dHdJQWdOZW1YY2N4d18xUWtlVjV1cF91NUFRTUMxMU5xNj1zOTYtYyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJzdWIiOiJhMzYxY2YxNS0xNTgxLTQ2ZDQtYmJkNC1mMGQ0NGFlNjkwODciLCJ0aWQiOiJmZDBiYzBlZi0xNzQ3LTRlZTYtYWIzZS1kNGQ2YmI4ODJkNDAiLCJhenAiOiJiYmQwN2Q0My0wMWNiLTRiNjktOGZkMC01NzQ2ZDlhNWM5ZmUiLCJ2ZXIiOiIxLjAiLCJpYXQiOjE2OTE3NjE1NDUsImF1ZCI6ImJiZDA3ZDQzLTAxY2ItNGI2OS04ZmQwLTU3NDZkOWE1YzlmZSIsImV4cCI6MTY5MTc2NTE0NSwiaXNzIjoiaHR0cHM6Ly90ZXJyYWRldmIyYy5iMmNsb2dpbi5jb20vZmQwYmMwZWYtMTc0Ny00ZWU2LWFiM2UtZDRkNmJiODgyZDQwL3YyLjAvIiwibmJmIjoxNjkxNzYxNTQ1fQ.k8XqUUWWfsJqVru8AdD8PqMw5js0Dlp7vtKWG2HxUDCNuQoz9ERs-QbvWU2XHmQZ2kS4zVtTzDoTc4PbNJ_Dy81I9nNDczdMxsyhKZ1GhJHiuS_h6nFaweLQTKCfrzye10VJdZlyR0cfBllbu7ct6-S91AvpTbwxKmU2p33eBw4ToEwdYNrDkbrIxmUHwrVN0nmoxQcIcouD0pOMcpR_Ad6hYWn1s9ug3BguM6jAhhjXWxJj4DIdcJ4mnDDhKkWbcV-NdphNVSl1COAY7hstEuHMK_3-Of6l1SMB9I-WA-M1esDmsXAcL1y8g0DTIdzDkEqrrxOb4k-NbQCgMiMElw"
        # Override default polling to make it faster for speedy tests
        poll-backoff {
          min: "10 seconds"
          max: "5 minutes"
          multiplier: 1.1
          randomization-factor: 0.5
        }

        use_tes_11_preview_backend_parameters = true

        filesystems {
          blob {
            enabled: true
          }
          local {
            enabled: false
          }
          http {
            enabled: true
          }
        }
      }

      # Have the engine (maybe) authenticate to docker.io. See BT-141 for more info.
      include "dockerhub_provider_config_v1.inc.conf"
    }
  }
}

workflow-options {
  # Directory where to write per workflow logs
  workflow-log-dir: "https://lz43a8a3d21540dfd25f5ace.blob.core.windows.net/sc-ebda3e1d-09bf-48b1-be2e-3d09f67dfc5c/workspace-services/cbas/terra-app-4628d0e1-d4b5-4b09-ad5c-9a5766650a7a/workflow-logs"
}

# call-caching {
#   # Allows re-use of existing results for jobs you've already run
#   # (default: false)
#   enabled = true
#
#   # Whether to invalidate a cache result forever if we cannot reuse them. Disable this if you expect some cache copies
#   # to fail for external reasons which should not invalidate the cache (e.g. auth differences between users):
#   # (default: true)
#   invalidate-bad-cache-results = false
#
#   # The maximum number of times Cromwell will attempt to copy cache hits before giving up and running the job.
#   max-failed-copy-attempts = 10
# }



# ////////////
# include required(classpath("application.conf"))
# include "build_application.inc.conf"
#
# filesystems {
#   blob {
#     class = "cromwell.filesystems.blob.BlobPathBuilderFactory"
#     global {
#       # One BFSM is shared across all BlobPathBuilders
#       class = "cromwell.filesystems.blob.BlobFileSystemManager"
#       config {
#         container: "cromwell"
#         endpoint: "https://<storage-account>.blob.core.windows.net"
#         subscription: "00001111-2222-3333-aaaa-bbbbccccdddd"
#         # WSM config is needed for accessing WSM-managed blob containers
#         # created in Terra workspaces.
#         workspace-manager {
#           url: "https://workspace.dsde-dev.broadinstitute.org"
#           workspace-id: "00001111-2222-3333-aaaa-bbbbccccdddd"
#           container-resource-id: "00001111-2222-3333-aaaa-bbbbccccdddd"
#           b2cToken: "Zardoz"
#         }
#       }
#     }
#   }
# }
#
# engine {
#   filesystems {
#     local {
#       enabled: true
#     }
#     http {
#       enabled: true
#     }
#     blob {
#       enabled: false
#     }
#   }
# }
#
#
# backend {
#   default = "TES"
#   providers {
#     TES {
#       actor-factory = "cromwell.backend.impl.tes.TesBackendLifecycleActorFactory"
#       config {
#         # Use for running on blob storage
#         #root = "https://<storage-account>.blob.core.windows.net/cromwell/cromwell-executions"
#         root = "cromwell-executions"
#         dockerRoot = "/cromwell-executions"
#         endpoint = "http://127.0.0.1:9000/v1/tasks"
#         concurrent-job-limit = 1000
#
#         # Override default polling to make it faster for speedy tests
#         poll-backoff {
#           min: "1 seconds"
#           max: "5 minutes"
#           multiplier: 1.1
#           randomization-factor: 0.5
#         }
#
#         filesystems {
#           blob {
#             enabled: false
#           }
#           local {
#             enabled: true
#           }
#           http {
#             enabled: true
#           }
#         }
#       }
#
#       # Have the engine (maybe) authenticate to docker.io. See BT-141 for more info.
#       include "dockerhub_provider_config_v1.inc.conf"
#     }
#   }
# }
