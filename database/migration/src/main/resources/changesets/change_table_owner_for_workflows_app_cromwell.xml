<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog objectQuotingStrategy="QUOTE_ALL_OBJECTS"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <!-- The 'sharedCromwellDbRole' can be set via JAVA_OPTS if desired (eg -DsharedCromwellDbRole=...). -->
    <property  name="sharedCromwellDbRole" value=""/>

    <!--
        This changeset will be only applied when 'sharedCromwellDbRole' property is set.
        Currently, it is only set for the shared Cromwell service in the WORKFLOWS app.
        For all the other Cromwell servers this should be a no-op.
     -->
    <changeSet author="sshah" id="change_table_owner_for_workflows_app_cromwell" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <!-- check that 'sharedCromwellDbRole' role is set -->
            <not>
                <sqlCheck expectedResult="0">
                    SELECT count(*)
                    FROM pg_roles
                    where '${sharedCromwellDbRole}' != '';
                </sqlCheck>
            </not>
        </preConditions>
        <sql>REASSIGN OWNED BY CURRENT_USER TO ${sharedCromwellDbRole};</sql>
    </changeSet>

</databaseChangeLog>
